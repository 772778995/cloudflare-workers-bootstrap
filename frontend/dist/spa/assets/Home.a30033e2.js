import{u as ft,a as mt,I as lt,V as pt,b as gt}from"./VoiceOff.1bb59300.js";import{c as vt,d as yt,w as st,e as F,f as wt,s as bt,g as Ct,r as Mt,h as kt,j as St,k as $t,o as Z,m as K,n as nt,F as Dt,p as _t,q as ot,t as Tt,v as xt,x as Rt}from"./index.18c85594.js";import{t as Et}from"./throwError.f2bb7a95.js";var dt={exports:{}};(function(a,t){(function(e,i){a.exports=i()})(vt,function(){var e=1e3,i=6e4,s=36e5,r="millisecond",o="second",d="minute",p="hour",u="day",n="week",m="month",M="quarter",C="year",w="date",_="Invalid Date",E=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,O=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,W={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(g){var l=["th","st","nd","rd"],c=g%100;return"["+g+(l[(c-20)%10]||l[c]||l[0])+"]"}},H=function(g,l,c){var f=String(g);return!f||f.length>=l?g:""+Array(l+1-f.length).join(c)+g},A={s:H,z:function(g){var l=-g.utcOffset(),c=Math.abs(l),f=Math.floor(c/60),h=c%60;return(l<=0?"+":"-")+H(f,2,"0")+":"+H(h,2,"0")},m:function g(l,c){if(l.date()<c.date())return-g(c,l);var f=12*(c.year()-l.year())+(c.month()-l.month()),h=l.clone().add(f,m),v=c-h<0,y=l.clone().add(f+(v?-1:1),m);return+(-(f+(c-h)/(v?h-y:y-h))||0)},a:function(g){return g<0?Math.ceil(g)||0:Math.floor(g)},p:function(g){return{M:m,y:C,w:n,d:u,D:w,h:p,m:d,s:o,ms:r,Q:M}[g]||String(g||"").toLowerCase().replace(/s$/,"")},u:function(g){return g===void 0}},T="en",S={};S[T]=W;var B="$isDayjsObject",I=function(g){return g instanceof X||!(!g||!g[B])},Y=function g(l,c,f){var h;if(!l)return T;if(typeof l=="string"){var v=l.toLowerCase();S[v]&&(h=v),c&&(S[v]=c,h=v);var y=l.split("-");if(!h&&y.length>1)return g(y[0])}else{var k=l.name;S[k]=l,h=k}return!f&&h&&(T=h),h||!f&&T},$=function(g,l){if(I(g))return g.clone();var c=typeof l=="object"?l:{};return c.date=g,c.args=arguments,new X(c)},b=A;b.l=Y,b.i=I,b.w=function(g,l){return $(g,{locale:l.$L,utc:l.$u,x:l.$x,$offset:l.$offset})};var X=function(){function g(c){this.$L=Y(c.locale,null,!0),this.parse(c),this.$x=this.$x||c.x||{},this[B]=!0}var l=g.prototype;return l.parse=function(c){this.$d=function(f){var h=f.date,v=f.utc;if(h===null)return new Date(NaN);if(b.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var y=h.match(E);if(y){var k=y[2]-1||0,D=(y[7]||"0").substring(0,3);return v?new Date(Date.UTC(y[1],k,y[3]||1,y[4]||0,y[5]||0,y[6]||0,D)):new Date(y[1],k,y[3]||1,y[4]||0,y[5]||0,y[6]||0,D)}}return new Date(h)}(c),this.init()},l.init=function(){var c=this.$d;this.$y=c.getFullYear(),this.$M=c.getMonth(),this.$D=c.getDate(),this.$W=c.getDay(),this.$H=c.getHours(),this.$m=c.getMinutes(),this.$s=c.getSeconds(),this.$ms=c.getMilliseconds()},l.$utils=function(){return b},l.isValid=function(){return this.$d.toString()!==_},l.isSame=function(c,f){var h=$(c);return this.startOf(f)<=h&&h<=this.endOf(f)},l.isAfter=function(c,f){return $(c)<this.startOf(f)},l.isBefore=function(c,f){return this.endOf(f)<$(c)},l.$g=function(c,f,h){return b.u(c)?this[f]:this.set(h,c)},l.unix=function(){return Math.floor(this.valueOf()/1e3)},l.valueOf=function(){return this.$d.getTime()},l.startOf=function(c,f){var h=this,v=!!b.u(f)||f,y=b.p(c),k=function(V,L){var j=b.w(h.$u?Date.UTC(h.$y,L,V):new Date(h.$y,L,V),h);return v?j:j.endOf(u)},D=function(V,L){return b.w(h.toDate()[V].apply(h.toDate("s"),(v?[0,0,0,0]:[23,59,59,999]).slice(L)),h)},x=this.$W,R=this.$M,P=this.$D,q="set"+(this.$u?"UTC":"");switch(y){case C:return v?k(1,0):k(31,11);case m:return v?k(1,R):k(0,R+1);case n:var z=this.$locale().weekStart||0,N=(x<z?x+7:x)-z;return k(v?P-N:P+(6-N),R);case u:case w:return D(q+"Hours",0);case p:return D(q+"Minutes",1);case d:return D(q+"Seconds",2);case o:return D(q+"Milliseconds",3);default:return this.clone()}},l.endOf=function(c){return this.startOf(c,!1)},l.$set=function(c,f){var h,v=b.p(c),y="set"+(this.$u?"UTC":""),k=(h={},h[u]=y+"Date",h[w]=y+"Date",h[m]=y+"Month",h[C]=y+"FullYear",h[p]=y+"Hours",h[d]=y+"Minutes",h[o]=y+"Seconds",h[r]=y+"Milliseconds",h)[v],D=v===u?this.$D+(f-this.$W):f;if(v===m||v===C){var x=this.clone().set(w,1);x.$d[k](D),x.init(),this.$d=x.set(w,Math.min(this.$D,x.daysInMonth())).$d}else k&&this.$d[k](D);return this.init(),this},l.set=function(c,f){return this.clone().$set(c,f)},l.get=function(c){return this[b.p(c)]()},l.add=function(c,f){var h,v=this;c=Number(c);var y=b.p(f),k=function(R){var P=$(v);return b.w(P.date(P.date()+Math.round(R*c)),v)};if(y===m)return this.set(m,this.$M+c);if(y===C)return this.set(C,this.$y+c);if(y===u)return k(1);if(y===n)return k(7);var D=(h={},h[d]=i,h[p]=s,h[o]=e,h)[y]||1,x=this.$d.getTime()+c*D;return b.w(x,this)},l.subtract=function(c,f){return this.add(-1*c,f)},l.format=function(c){var f=this,h=this.$locale();if(!this.isValid())return h.invalidDate||_;var v=c||"YYYY-MM-DDTHH:mm:ssZ",y=b.z(this),k=this.$H,D=this.$m,x=this.$M,R=h.weekdays,P=h.months,q=h.meridiem,z=function(L,j,U,G){return L&&(L[j]||L(f,v))||U[j].slice(0,G)},N=function(L){return b.s(k%12||12,L,"0")},V=q||function(L,j,U){var G=L<12?"AM":"PM";return U?G.toLowerCase():G};return v.replace(O,function(L,j){return j||function(U){switch(U){case"YY":return String(f.$y).slice(-2);case"YYYY":return b.s(f.$y,4,"0");case"M":return x+1;case"MM":return b.s(x+1,2,"0");case"MMM":return z(h.monthsShort,x,P,3);case"MMMM":return z(P,x);case"D":return f.$D;case"DD":return b.s(f.$D,2,"0");case"d":return String(f.$W);case"dd":return z(h.weekdaysMin,f.$W,R,2);case"ddd":return z(h.weekdaysShort,f.$W,R,3);case"dddd":return R[f.$W];case"H":return String(k);case"HH":return b.s(k,2,"0");case"h":return N(1);case"hh":return N(2);case"a":return V(k,D,!0);case"A":return V(k,D,!1);case"m":return String(D);case"mm":return b.s(D,2,"0");case"s":return String(f.$s);case"ss":return b.s(f.$s,2,"0");case"SSS":return b.s(f.$ms,3,"0");case"Z":return y}return null}(L)||y.replace(":","")})},l.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},l.diff=function(c,f,h){var v,y=this,k=b.p(f),D=$(c),x=(D.utcOffset()-this.utcOffset())*i,R=this-D,P=function(){return b.m(y,D)};switch(k){case C:v=P()/12;break;case m:v=P();break;case M:v=P()/3;break;case n:v=(R-x)/6048e5;break;case u:v=(R-x)/864e5;break;case p:v=R/s;break;case d:v=R/i;break;case o:v=R/e;break;default:v=R}return h?v:b.a(v)},l.daysInMonth=function(){return this.endOf(m).$D},l.$locale=function(){return S[this.$L]},l.locale=function(c,f){if(!c)return this.$L;var h=this.clone(),v=Y(c,f,!0);return v&&(h.$L=v),h},l.clone=function(){return b.w(this.$d,this)},l.toDate=function(){return new Date(this.valueOf())},l.toJSON=function(){return this.isValid()?this.toISOString():null},l.toISOString=function(){return this.$d.toISOString()},l.toString=function(){return this.$d.toUTCString()},g}(),rt=X.prototype;return $.prototype=rt,[["$ms",r],["$s",o],["$m",d],["$H",p],["$W",u],["$M",m],["$y",C],["$D",w]].forEach(function(g){rt[g[1]]=function(l){return this.$g(l,g[0],g[1])}}),$.extend=function(g,l){return g.$i||(g(l,X,$),g.$i=!0),$},$.locale=Y,$.isDayjs=I,$.unix=function(g){return $(1e3*g)},$.en=S[T],$.Ls=S,$.p={},$})})(dt);var Lt=dt.exports,Wt=globalThis&&globalThis.__awaiter||function(a,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function d(n){try{u(i.next(n))}catch(m){o(m)}}function p(n){try{u(i.throw(n))}catch(m){o(m)}}function u(n){n.done?r(n.value):s(n.value).then(d,p)}u((i=i.apply(a,t||[])).next())})};function Ot(a,t){return Wt(this,void 0,void 0,function*(){const e=new AudioContext({sampleRate:t});return e.decodeAudioData(a).finally(()=>e.close())})}function Pt(a){const t=a[0];if(t.some(e=>e>1||e<-1)){const e=t.length;let i=0;for(let s=0;s<e;s++){const r=Math.abs(t[s]);r>i&&(i=r)}for(const s of a)for(let r=0;r<e;r++)s[r]/=i}return a}function Ht(a,t){return typeof a[0]=="number"&&(a=[a]),Pt(a),{duration:t,length:a[0].length,sampleRate:a[0].length/t,numberOfChannels:a.length,getChannelData:e=>a==null?void 0:a[e],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}const at={decode:Ot,createBuffer:Ht};var ct=globalThis&&globalThis.__awaiter||function(a,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function d(n){try{u(i.next(n))}catch(m){o(m)}}function p(n){try{u(i.throw(n))}catch(m){o(m)}}function u(n){n.done?r(n.value):s(n.value).then(d,p)}u((i=i.apply(a,t||[])).next())})};function At(a,t,e){var i,s;return ct(this,void 0,void 0,function*(){const r=yield fetch(a,e);{const o=(i=r.clone().body)===null||i===void 0?void 0:i.getReader(),d=Number((s=r.headers)===null||s===void 0?void 0:s.get("Content-Length"));let p=0;const u=(n,m)=>ct(this,void 0,void 0,function*(){if(n)return;p+=(m==null?void 0:m.length)||0;const M=Math.round(p/d*100);return t(M),o==null?void 0:o.read().then(({done:C,value:w})=>u(C,w))});o==null||o.read().then(({done:n,value:m})=>u(n,m))}return r.blob()})}const Bt={fetchBlob:At};class tt{constructor(){this.listeners={}}on(t,e){return this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),()=>this.un(t,e)}once(t,e){const i=this.on(t,e),s=this.on(t,()=>{i(),s()});return i}un(t,e){this.listeners[t]&&(e?this.listeners[t].delete(e):delete this.listeners[t])}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach(i=>i(...e))}}class jt extends tt{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)})}onMediaEvent(t,e,i){return this.media.addEventListener(t,e,i),()=>this.media.removeEventListener(t,e)}onceMediaEvent(t,e){return this.onMediaEvent(t,e,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}setSrc(t,e){if(this.getSrc()===t)return;this.revokeSrc();const s=e instanceof Blob?URL.createObjectURL(e):t;this.media.src=s,this.media.load()}destroy(){this.media.pause(),!this.isExternalMedia&&(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return this.media.currentTime>0&&!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=t}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(t,e){e!=null&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setMediaElement(t){this.media=t}setSinkId(t){return this.media.setSinkId(t)}}function Ft(a,t,e,i,s=5){let r=()=>{};if(!a)return r;const o=d=>{if(d.button===2)return;d.preventDefault(),d.stopPropagation();let p=d.clientX,u=d.clientY,n=!1;const m=w=>{w.preventDefault(),w.stopPropagation();const _=w.clientX,E=w.clientY;if(n||Math.abs(_-p)>=s||Math.abs(E-u)>=s){const{left:O,top:W}=a.getBoundingClientRect();n||(n=!0,e==null||e(p-O,u-W)),t(_-p,E-u,_-O,E-W),p=_,u=E}},M=w=>{n&&(w.preventDefault(),w.stopPropagation())},C=()=>{n&&(i==null||i()),r()};document.addEventListener("pointermove",m),document.addEventListener("pointerup",C),document.addEventListener("pointerleave",C),document.addEventListener("click",M,!0),r=()=>{document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",C),document.removeEventListener("pointerleave",C),setTimeout(()=>{document.removeEventListener("click",M,!0)},10)}};return a.addEventListener("pointerdown",o),()=>{r(),a.removeEventListener("pointerdown",o)}}class Q extends tt{constructor(t,e){super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=t;const i=this.parentFromOptionsContainer(t.container);this.parent=i;const[s,r]=this.initHtml();i.appendChild(s),this.container=s,this.scrollContainer=r.querySelector(".scroll"),this.wrapper=r.querySelector(".wrapper"),this.canvasWrapper=r.querySelector(".canvases"),this.progressWrapper=r.querySelector(".progress"),this.cursor=r.querySelector(".cursor"),e&&r.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if(typeof t=="string"?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw new Error("Container not found");return e}initEvents(){const t=i=>{const s=this.wrapper.getBoundingClientRect(),r=i.clientX-s.left,o=i.clientX-s.left,d=r/s.width,p=o/s.height;return[d,p]};this.wrapper.addEventListener("click",i=>{const[s,r]=t(i);this.emit("click",s,r)}),this.wrapper.addEventListener("dblclick",i=>{const[s,r]=t(i);this.emit("dblclick",s,r)}),this.options.dragToSeek&&this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:i,scrollWidth:s,clientWidth:r}=this.scrollContainer,o=i/s,d=(i+r)/s;this.emit("scroll",o,d)});const e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){Ft(this.wrapper,(t,e,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const t=document.createElement("div"),e=t.attachShadow({mode:"open"});return e.innerHTML=`
      <style>
        :host {
          user-select: none;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
          touch-action: none;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,e]}setOptions(t){if(this.options.container!==t.container){const e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}this.options=t,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var t;this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect()}createDelay(t=10){const e={};return this.timeouts.push(e),i=>{e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(i,t)}}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const e=document.createElement("canvas"),s=e.getContext("2d").createLinearGradient(0,0,0,e.height),r=1/(t.length-1);return t.forEach((o,d)=>{const p=d*r;s.addColorStop(p,o)}),s}renderBarWaveform(t,e,i,s){const r=t[0],o=t[1]||t[0],d=r.length,{width:p,height:u}=i.canvas,n=u/2,m=window.devicePixelRatio||1,M=e.barWidth?e.barWidth*m:1,C=e.barGap?e.barGap*m:e.barWidth?M/2:0,w=e.barRadius||0,_=p/(M+C)/d,E=w&&"roundRect"in i?"roundRect":"rect";i.beginPath();let O=0,W=0,H=0;for(let A=0;A<=d;A++){const T=Math.round(A*_);if(T>O){const I=Math.round(W*n*s),Y=Math.round(H*n*s),$=I+Y||1;let b=n-I;e.barAlign==="top"?b=0:e.barAlign==="bottom"&&(b=u-$),i[E](O*(M+C),b,M,$,w),O=T,W=0,H=0}const S=Math.abs(r[A]||0),B=Math.abs(o[A]||0);S>W&&(W=S),B>H&&(H=B)}i.fill(),i.closePath()}renderLineWaveform(t,e,i,s){const r=o=>{const d=t[o]||t[0],p=d.length,{height:u}=i.canvas,n=u/2,m=i.canvas.width/p;i.moveTo(0,n);let M=0,C=0;for(let w=0;w<=p;w++){const _=Math.round(w*m);if(_>M){const O=Math.round(C*n*s)||1,W=n+O*(o===0?-1:1);i.lineTo(M,W),M=_,C=0}const E=Math.abs(d[w]||0);E>C&&(C=E)}i.lineTo(M,n)};i.beginPath(),r(0),r(1),i.fill(),i.closePath()}renderWaveform(t,e,i){if(i.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction){e.renderFunction(t,i);return}let s=e.barHeight||1;if(e.normalize){const r=Array.from(t[0]).reduce((o,d)=>Math.max(o,Math.abs(d)),0);s=r?1/r:1}if(e.barWidth||e.barGap||e.barAlign){this.renderBarWaveform(t,e,i,s);return}this.renderLineWaveform(t,e,i,s)}renderSingleCanvas(t,e,i,s,r,o,d,p){const u=window.devicePixelRatio||1,n=document.createElement("canvas"),m=t[0].length;n.width=Math.round(i*(o-r)/m),n.height=s*u,n.style.width=`${Math.floor(n.width/u)}px`,n.style.height=`${s}px`,n.style.left=`${Math.floor(r*i/u/m)}px`,d.appendChild(n);const M=n.getContext("2d");this.renderWaveform(t.map(_=>_.slice(r,o)),e,M);const C=n.cloneNode();p.appendChild(C);const w=C.getContext("2d");n.width>0&&n.height>0&&w.drawImage(n,0,0),w.globalCompositeOperation="source-in",w.fillStyle=this.convertColorValues(e.progressColor),w.fillRect(0,0,n.width,n.height)}renderChannel(t,e,i){const s=document.createElement("div"),r=this.getHeight();s.style.height=`${r}px`,this.canvasWrapper.style.minHeight=`${r}px`,this.canvasWrapper.appendChild(s);const o=s.cloneNode();this.progressWrapper.appendChild(o);const{scrollLeft:d,scrollWidth:p,clientWidth:u}=this.scrollContainer,n=t[0].length,m=n/p;let M=Math.min(Q.MAX_CANVAS_WIDTH,u);if(e.barWidth||e.barGap){const T=e.barWidth||.5,S=e.barGap||T/2,B=T+S;M%B!==0&&(M=Math.floor(M/B)*B)}const C=Math.floor(Math.abs(d)*m),w=Math.floor(C+M*m),_=w-C,E=(T,S)=>{this.renderSingleCanvas(t,e,i,r,Math.max(0,T),Math.min(S,n),s,o)},O=this.createDelay(),W=this.createDelay(),H=(T,S)=>{E(T,S),T>0&&O(()=>{H(T-_,S-_)})},A=(T,S)=>{E(T,S),S<n&&W(()=>{A(T+_,S+_)})};H(C,w),w<n&&A(w,w+_)}render(t){this.timeouts.forEach(d=>d.timeout&&clearTimeout(d.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="";const e=window.devicePixelRatio||1,i=this.scrollContainer.clientWidth,s=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrolling=s>i;const r=this.options.fillParent&&!this.isScrolling,o=(r?i:s)*e;if(this.wrapper.style.width=r?"100%":`${s}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let d=0;d<t.numberOfChannels;d++){const p=Object.assign(Object.assign({},this.options),this.options.splitChannels[d]);this.renderChannel([t.getChannelData(d)],p,o)}else{const d=[t.getChannelData(0)];t.numberOfChannels>1&&d.push(t.getChannelData(1)),this.renderChannel(d,this.options,o)}this.audioData=t,this.emit("render")}reRender(){if(!this.audioData)return;const t=this.progressWrapper.clientWidth;this.render(this.audioData);const e=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=e-t}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){const{clientWidth:i,scrollLeft:s,scrollWidth:r}=this.scrollContainer,o=r*t,d=i/2,p=e&&this.options.autoCenter&&!this.isDragging?d:i;if(o>s+p||o<s)if(this.options.autoCenter&&!this.isDragging){const u=d/20;o-(s+d)>=u&&o<s+i?this.scrollContainer.scrollLeft+=u:this.scrollContainer.scrollLeft=o-d}else this.isDragging?this.scrollContainer.scrollLeft=o<s?o-10:o-i+10:this.scrollContainer.scrollLeft=o;{const{scrollLeft:u}=this.scrollContainer,n=u/r,m=(u+i)/r;this.emit("scroll",n,m)}}renderProgress(t,e){isNaN(t)||(this.progressWrapper.style.width=`${t*100}%`,this.cursor.style.left=`${t*100}%`,this.cursor.style.marginLeft=Math.round(t*100)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(t,e))}}Q.MAX_CANVAS_WIDTH=4e3;class zt extends tt{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}var J=globalThis&&globalThis.__awaiter||function(a,t,e,i){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function d(n){try{u(i.next(n))}catch(m){o(m)}}function p(n){try{u(i.throw(n))}catch(m){o(m)}}function u(n){n.done?r(n.value):s(n.value).then(d,p)}u((i=i.apply(a,t||[])).next())})};const Vt={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class et extends jt{static create(t){return new et(t)}constructor(t){var e,i;super({media:t.media,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.options=Object.assign({},Vt,t),this.timer=new zt;const s=t.media?void 0:this.getMediaElement();this.renderer=new Q(this.options,s),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const r=this.options.url||((e=this.options.media)===null||e===void 0?void 0:e.currentSrc)||((i=this.options.media)===null||i===void 0?void 0:i.src);r&&this.load(r,this.options.peaks,this.options.duration)}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const t=this.getCurrentTime();this.renderer.renderProgress(t/this.getDuration(),!0),this.emit("timeupdate",t),this.emit("audioprocess",t)}))}initPlayerEvents(){this.subscriptions.push(this.onMediaEvent("timeupdate",()=>{const t=this.getCurrentTime();this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))}),this.renderer.on("dblclick",(t,e)=>{this.emit("dblclick",t,e)}),this.renderer.on("scroll",(t,e)=>{const i=this.getDuration();this.emit("scroll",t*i,e*i)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let t;this.subscriptions.push(this.renderer.on("drag",e=>{!this.options.interact||(this.renderer.renderProgress(e),clearTimeout(t),t=setTimeout(()=>{this.seekTo(e)},this.isPlaying()?0:200),this.emit("interaction",e*this.getDuration()),this.emit("drag",e))}))}}initPlugins(){var t;!(!((t=this.options.plugins)===null||t===void 0)&&t.length)||this.options.plugins.forEach(e=>{this.registerPlugin(e)})}setOptions(t){this.options=Object.assign({},this.options,t),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t.init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter(e=>e!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadAudio(t,e,i,s){return J(this,void 0,void 0,function*(){if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!e&&!i){const r=o=>this.emit("loading",o);e=yield Bt.fetchBlob(t,r,this.options.fetchParams)}if(this.setSrc(t,e),i)s=(yield Promise.resolve(s||this.getDuration()))||(yield new Promise(r=>{this.onceMediaEvent("loadedmetadata",()=>r(this.getDuration()))}))||(yield Promise.resolve(0)),this.decodedData=at.createBuffer(i,s);else if(e){const r=yield e.arrayBuffer();this.decodedData=yield at.decode(r,this.options.sampleRate)}this.emit("decode",this.getDuration()),this.decodedData&&this.renderer.render(this.decodedData),this.emit("ready",this.getDuration())})}load(t,e,i){return J(this,void 0,void 0,function*(){yield this.loadAudio(t,void 0,e,i)})}loadBlob(t,e,i){return J(this,void 0,void 0,function*(){yield this.loadAudio("blob",t,e,i)})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const s=Math.min(t,this.decodedData.numberOfChannels),r=[];for(let o=0;o<s;o++){const d=this.decodedData.getChannelData(o),p=[],u=Math.round(d.length/e);for(let n=0;n<e;n++){const m=d.slice(n*u,(n+1)*u),M=Math.max(...m);p.push(Math.round(M*i)/i)}r.push(p)}return r}getDuration(){let t=super.getDuration()||0;return(t===0||t===1/0)&&this.decodedData&&(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}seekTo(t){const e=this.getDuration()*t;this.setTime(e)}playPause(){return J(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}destroy(){this.emit("destroy"),this.plugins.forEach(t=>t.destroy()),this.subscriptions.forEach(t=>t()),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}function ht(a,t,e,i){return new(e||(e=Promise))(function(s,r){function o(u){try{p(i.next(u))}catch(n){r(n)}}function d(u){try{p(i.throw(u))}catch(n){r(n)}}function p(u){var n;u.done?s(u.value):(n=u.value,n instanceof e?n:new e(function(m){m(n)})).then(o,d)}p((i=i.apply(a,t||[])).next())})}class It{constructor(){this.listeners={}}on(t,e){return this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),()=>this.un(t,e)}once(t,e){const i=this.on(t,e),s=this.on(t,()=>{i(),s()});return i}un(t,e){this.listeners[t]&&(e?this.listeners[t].delete(e):delete this.listeners[t])}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach(i=>i(...e))}}class Yt extends It{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}}const qt=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class it extends Yt{constructor(t){var e;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(e=t.audioBitsPerSecond)!==null&&e!==void 0?e:128e3})),this.stream=null,this.mediaRecorder=null}static create(t){return new it(t||{})}renderMicStream(t){const e=new AudioContext,i=e.createMediaStreamSource(t),s=e.createAnalyser();i.connect(s);const r=s.frequencyBinCount,o=new Float32Array(r),d=r/e.sampleRate;let p;const u=()=>{s.getFloatTimeDomainData(o),this.wavesurfer&&(this.wavesurfer.options.cursorWidth=0,this.wavesurfer.options.interact=!1,this.wavesurfer.load("",[o],d)),p=requestAnimationFrame(u)};return u(),()=>{cancelAnimationFrame(p),i==null||i.disconnect(),e==null||e.close()}}startMic(){return ht(this,void 0,void 0,function*(){let t;try{t=yield navigator.mediaDevices.getUserMedia({audio:!0})}catch(i){throw new Error("Error accessing the microphone: "+i.message)}const e=this.renderMicStream(t);return this.subscriptions.push(this.once("destroy",e)),this.stream=t,t})}stopMic(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null)}startRecording(){return ht(this,void 0,void 0,function*(){const t=this.stream||(yield this.startMic()),e=this.mediaRecorder||new MediaRecorder(t,{mimeType:this.options.mimeType||qt.find(s=>MediaRecorder.isTypeSupported(s)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=e,this.stopRecording();const i=[];e.ondataavailable=s=>{s.data.size>0&&i.push(s.data)},e.onstop=()=>{var s;const r=new Blob(i,{type:e.mimeType});this.emit("record-end",r),this.options.renderRecordedAudio!==!1&&((s=this.wavesurfer)===null||s===void 0||s.load(URL.createObjectURL(r)))},e.start(),this.emit("record-start")})}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}stopRecording(){var t;this.isRecording()&&((t=this.mediaRecorder)===null||t===void 0||t.stop())}destroy(){super.destroy(),this.stopRecording(),this.stopMic()}}const ut=yt("recorder",{state:()=>({waveSurfer:null,waveSurferOpts:{container:"#recorder",height:200,barWidth:5,barRadius:60,waveColor:ft().themeCss["primary-5"]},recorder:null,isRecording:!1,audioDuration:Lt(0).add(30,"s"),recorderTimer:{audioDuration:0,timer:-1}}),actions:{async init(){await this.authMicrophone(),this.initWaveSurfer(),this.initRecorderPlugin(),this.recorder.startRecording()},async authMicrophone(){mt("microphone").value!=="granted"&&await navigator.mediaDevices.getUserMedia({audio:!0}).catch(Et)},initWaveSurfer(){st(this.waveSurferOpts,a=>{this.waveSurfer&&this.waveSurfer.destroy(),this.waveSurfer=et.create(a)},{immediate:!0,deep:!0})},initRecorderPlugin(){st(()=>this.waveSurfer,()=>{var a,t;if((a=this.recorder)==null||a.on("destroy",()=>{this.recorderTimer.audioDuration=0,clearInterval(this.recorderTimer.timer)}),!this.waveSurfer)return(t=this.recorder)==null?void 0:t.destroy();this.recorder&&this.recorder.destroy(),this.recorder=this.waveSurfer.registerPlugin(it.create()),this.recorder.on("record-start",async()=>{this.isRecording=!0,this.recorderTimer.timer=setInterval(()=>this.recorderTimer.audioDuration+=1e3,1e3)}),this.recorder.on("record-end",async()=>{this.isRecording=!1,clearInterval(this.recorderTimer.timer),this.recorderTimer.audioDuration=0})},{immediate:!0})}}});var Nt=lt("audio-file",!0,function(a){return F("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},[F("path",{d:"M8 44V4H31L40 14.5V44H8Z",fill:a.colors[1],stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),F("path",{d:"M32 14L26 16.9688V31.5",stroke:a.colors[2],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),F("circle",{cx:"20.5",cy:"31.5",r:"5.5",fill:a.colors[3],stroke:a.colors[2],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null)])}),Ut=lt("people",!1,function(a){return F("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},[F("path",{d:"M24 20C27.866 20 31 16.866 31 13C31 9.13401 27.866 6 24 6C20.134 6 17 9.13401 17 13C17 16.866 20.134 20 24 20Z",fill:a.colors[1],stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),F("path",{d:"M6 40.8V42H42V40.8C42 36.3196 42 34.0794 41.1281 32.3681C40.3611 30.8628 39.1372 29.6389 37.6319 28.8719C35.9206 28 33.6804 28 29.2 28H18.8C14.3196 28 12.0794 28 10.3681 28.8719C8.86278 29.6389 7.63893 30.8628 6.87195 32.3681C6 34.0794 6 36.3196 6 40.8Z",fill:a.colors[1],stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null)])});const Xt=()=>{const a=wt(),{isRecording:t}=bt(ut()),e=Ct(()=>[{name:"\u5F55\u97F3\u5668",icon:t.value?pt:gt},{name:"\u97F3\u9891\u6587\u4EF6",icon:Nt},{name:"\u6211\u7684",icon:Ut}]),i=Mt(e.value[0]);return kt(()=>{a.push({name:i.value.name})}),{tabList:e,activeTab:i}},Gt={_nm:"flat-q-primary-8"},Zt={_m:"t-auto 25px",_flex:"~ justify-between"},Jt=["title","onClick"],ee=St({__name:"Home",setup(a){const{tabList:t,activeTab:e}=Xt();return ut().init(),(i,s)=>{const r=$t("router-view");return Z(),K("div",Gt,[F(r),nt("div",Zt,[(Z(!0),K(Dt,null,_t(ot(t),o=>(Z(),K("div",{key:o.name,title:o.name,_nm:"flat-q-primary-7-sm",_flex:"~ center",_w:"50px",_h:"50px",_cursor:"pointer",_p:"2px",_border:"rounded-8px",_transition:"duration-300",_filter:"~",_transform:"gpu",_active:"scale-95 brightness-95",onClick:d=>e.value=o},[nt("div",{_flex:"~ center",_w:"full",_h:"full",_border:"rounded-8px",_transition:"all duration-300",class:Tt({"nm-inset-q-primary-7-sm":o.name===ot(e).name})},[(Z(),xt(Rt(o.icon),{_transform:"~ translate-y-2px",_text:"q-primary-9 3xl"}))],2)],8,Jt))),128))])])}}});export{ee as default};
